<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Aktywność Ziemi</title>
<link rel="icon" type="image/ico" href="wulkan.ico">

<link rel="stylesheet" href="leaflet.css">
<link rel="stylesheet" href="L.Icon.Pulse.css" />

<style>
html, body, #map {
    width: 100%;
    height: 100%;
    margin: 0;
}

.legend {
    background: rgba(255,255,255,0.95);
    padding: 8px;
    border-radius: 6px;
    font-size: 13px;
    line-height: 1.4;
    margin-bottom: 6px;
}

.volcano {
    font-size: 16px;
    font-weight: bold;
    text-align: center;
}

</style>
</head>

<body>
<div id="map"></div>
<script src="leaflet.js"></script>
<script src="L.Icon.Pulse.js"></script>

<script>

var map = L.map('map').setView([20, 10], 3);

var satellite = L.tileLayer(
 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
).addTo(map);

var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png');
var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png');

var layerControl = L.control.layers(
    { "Satelita": satellite, "OSM": osm, "Mapa fizyczna": topo },
    {},
    { collapsed: false }
).addTo(map);

var legends = {};

function addLegend(name) {
    if (legends[name]) legends[name].addTo(map);
}

function removeLegend(name) {
    if (legends[name]) map.removeControl(legends[name]);
}


var platesLayer = L.layerGroup();

fetch('tectonicplates.json')
.then(r => r.json())
.then(data => {
    L.geoJSON(data, {
        style: { color: '#ff4500', weight: 3 },
    onEachFeature: function(feature, layer) {
            var name = feature.properties.Name || "Granica płyt";
            layer.bindPopup("<b>Płyta tektoniczna</b><br>" + name);
        }
    }).addTo(platesLayer);

    legends["Płyty"] = L.control({ position: 'bottomleft' });
    legends["Płyty"].onAdd = function () {
        var d = L.DomUtil.create('div', 'legend');
        d.innerHTML = "<b>Płyty tektoniczne</b><br><span style='color:#ff4500'>━━━</span> granice";
        return d;
    };

    layerControl.addOverlay(platesLayer, "Płyty");
});


var earthquakesLayer = L.layerGroup();

fetch('earthquakes.json')
.then(r => r.json())
.then(data => {

    data.features.forEach(f => {
        var mag = f.properties.mag;
        if (!mag) return; 

        var finalLayer; 
        if (mag > 5.0) {
            
            var pulsingIcon = L.icon.pulse({
                iconSize: [12, 12],   
                color: 'red',       
                fillColor: 'red',     
                heartbeat: mag > 6 ? 0.8 : 2 
            });

            finalLayer = L.marker(
                [f.geometry.coordinates[1], f.geometry.coordinates[0]], 
                { icon: pulsingIcon }
            );

        } else {

            finalLayer = L.circleMarker(
                [f.geometry.coordinates[1], f.geometry.coordinates[0]],
                {
                    radius: mag * 2,  
                    color: '#fc8d59', 
                    fillOpacity: 0.6,
                    weight: 1
                }
            );
        }

        
        finalLayer.bindPopup(
            "<b>Trzęsienie ziemi</b><br>" +
            f.properties.place + "<br>" +
            "Magnituda: " + mag + "<br>" +
            "<a href='" + f.properties.url + "' target='_blank'>Źródło</a>"
        );

        earthquakesLayer.addLayer(finalLayer);
    });

    data.features.forEach(f => {
        var mag = f.properties.mag;
        var color = mag > 6 ? '#800000' :
                    mag > 5 ? '#b30000' :
                    mag > 4 ? '#e34a33' : '#fc8d59';

        var marker = L.circleMarker(
            [f.geometry.coordinates[1], f.geometry.coordinates[0]],
            {
                radius: mag * 3,
                color: color,
                fillOpacity: 0.8
            }
        );

        marker.bindPopup(
            "<b>Trzęsienie ziemi</b><br>" +
            f.properties.place + "<br>" +
            "Magnituda: " + mag + "<br>" +
            "<a href='" + f.properties.url + "' target='_blank'>Źródło</a>"
        );

        earthquakesLayer.addLayer(marker);
    });

    legends["Trzęsienia"] = L.control({ position: 'bottomleft' });
    legends["Trzęsienia"].onAdd = function () {
        var d = L.DomUtil.create('div', 'legend');
        d.innerHTML =
            "<b>Magnituda</b><br>" +
            "<span style='color:#800000'>●</span> > 6<br>" +
            "<span style='color:#b30000'>●</span> 5–6<br>" +
            "<span style='color:#e34a33'>●</span> 4–5";
        return d;
    };

    layerControl.addOverlay(earthquakesLayer, "Trzęsienia");
});


var volcanoLayer = L.layerGroup();

fetch('volcano.json')
.then(r => r.json())
.then(data => {

    data.features.forEach(f => {
        var pei = f.properties.PEI;
        if (pei === null) return;

        var color = pei > 15 ? '#800026' :
                    pei > 10 ? '#bd0026' :
                    pei > 5  ? '#f03b20' : '#fd8d3c';

        var marker = L.marker(
            [f.geometry.coordinates[1], f.geometry.coordinates[0]],
            {
                icon: L.divIcon({
                    className: 'volcano',
                    html: "<span style='color:"+color+"'>▲</span>",
                    iconSize: [16,16]
                })
            }
        );



        marker.bindPopup(
            "<b>" + f.properties.V_Name + "</b><br>" +
            "Kraj: " + f.properties.Country + "<br>" +
            "PEI: " + pei
        );

        volcanoLayer.addLayer(marker);
    });

    legends["Wulkany"] = L.control({ position: 'bottomleft' });
    legends["Wulkany"].onAdd = function () {
        var d = L.DomUtil.create('div', 'legend');
        d.innerHTML =
            "<b>Wulkany (PEI)</b><br>" +
            "<span style='color:#800026'>▲</span> bardzo wysokie<br>" +
            "<span style='color:#bd0026'>▲</span> wysokie<br>" +
            "<span style='color:#f03b20'>▲</span> średnie";
        return d;
    };

    layerControl.addOverlay(volcanoLayer, "Wulkany");
});

map.on('overlayadd', e => addLegend(e.name));
map.on('overlayremove', e => removeLegend(e.name));

</script>
</body>
</html>
 
